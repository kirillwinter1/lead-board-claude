# F15 WIP Limits — Руководство пользователя

## Что это и зачем

**WIP (Work In Progress) Limits** — ограничения на количество параллельной работы. Это позволяет:

- **Реалистичнее планировать** — команда не работает над 10 эпиками одновременно
- **Быстрее завершать топ-приоритеты** — ресурсы не размазываются
- **Видеть узкие места** — где "пробки" в процессе

---

## Как работает

### Без WIP (было раньше)
```
Все 5 эпиков работают параллельно:
Epic 1 ═══════════════════════════════►
Epic 2 ═══════════════════════════════►
Epic 3 ═══════════════════════════════►
Epic 4 ═══════════════════════════════►
Epic 5 ═══════════════════════════════►

Capacity размазывается на все. Каждый получает 20%.
```

### С WIP = 3 (теперь)
```
Epic 1 ████████████░░░░░░░░░░░░░░░░░░░
Epic 2 ████████████████░░░░░░░░░░░░░░░
Epic 3 ████████████████████░░░░░░░░░░░
Epic 4        [ждёт]  ████████████████
Epic 5              [ждёт]  ██████████

Только 3 эпика активны. Каждый получает 33%.
Топ-приоритеты завершаются быстрее.
```

---

## Уровни WIP лимитов

### 1. Командный WIP
Общий лимит на количество эпиков в работе. По умолчанию: **6**

### 2. Роль-специфичные WIP
Лимиты по фазам (SA → DEV → QA):
- **SA:** 2 (сколько эпиков может быть в аналитике)
- **DEV:** 3 (сколько в разработке)
- **QA:** 2 (сколько на тестировании)

Эпик может ждать входа в фазу, даже если предыдущая завершена.

---

## Где настроить

**Teams → Edit Team → Planning Config:**

```json
{
  "wipLimits": {
    "team": 6,
    "sa": 2,
    "dev": 3,
    "qa": 2
  }
}
```

---

## UI на Timeline

### 1. Summary Panel
```
5 epics · 3 on track · WIP 3/6 · SA: 1/2  DEV: 2/3  QA: 1/2 · ⏳ 2 in queue
```

Цвета badges:
| Цвет | Значение |
|------|----------|
| 🔵 Синий | < 80% лимита (нормально) |
| 🟡 Жёлтый | ≥ 80% или на пределе (внимание) |
| 🔴 Красный | Превышен лимит (критично) |

### 2. WIP Insights Panel
Автоматические рекомендации:
- "Team WIP exceeded" → завершите эпики перед новыми
- "Bottleneck detected: DEV at capacity" → добавьте ресурсы
- "3 epics waiting in queue" → увеличьте лимит или фокусируйтесь
- "WIP is healthy" → всё хорошо, утилизация X%

### 3. Очередь эпиков
- Эпики за пределами WIP показываются с badge `#1`, `#2`
- В tooltip видно `Queue position` и `Waiting until`
- Строка подсвечена серым

### 4. WIP History Chart
График утилизации за последние 30 дней:
- **Синяя линия** — текущий WIP
- **Красная пунктирная** — лимит
- Точки красные если WIP превышен

Снапшоты создаются автоматически в 9:00 каждый день.
Можно создать вручную кнопкой "+ Snapshot".

---

## API

```bash
# Получить прогноз с WIP статусом
GET /api/planning/forecast?teamId=1

# Получить историю WIP (30 дней)
GET /api/planning/wip-history?teamId=1&days=30

# Создать снапшот вручную
POST /api/planning/wip-snapshot?teamId=1
```

---

## Пример сценария

1. Команда имеет 8 эпиков, WIP = 4
2. Первые 4 эпика начинают работу сразу
3. Эпики 5-8 в очереди, показаны как `⏳ #1`, `⏳ #2`...
4. Когда эпик #1 завершается → эпик #5 начинает работу
5. Timeline автоматически пересчитывает даты с учётом очереди

---

## Технические детали

### Backend файлы
- `ForecastService.java` — алгоритм с WIP
- `WipSnapshotService.java` — снапшоты и scheduled jobs
- `EpicForecast.java` — поля queuePosition, isWithinWip, phaseWaitInfo

### Frontend файлы
- `TimelinePage.tsx` — SummaryPanel, WipInsightsPanel, WipHistoryChart
- `forecast.ts` — TypeScript типы

### База данных
- `wip_snapshots` — таблица для хранения истории WIP
